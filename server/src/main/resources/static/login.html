<!DOCTYPE html>
    <head>
        <title>Event Management|TvM Evento</title>
        <link rel="stylesheet" href="/css/styles2.css">
        <link rel="website icon" type="png" href="/photos/newlogoevnto.png">
        <script src="/js/authInterceptor.js" crossorigin="anonymous"></script>
        <script src="https://kit.fontawesome.com/84f63f6754.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="hero">
            <a href="index.html"><i class="fa-solid fa-arrow-right-from-bracket fa-flip-horizontal" style="color: #ffffff;"></i></a>
            <div class="form-box">
                <div class="button-box">
                    <div id="btn"></div>
                    <button style="color: rgb(204, 106, 8)" type="button" class="toggle-btn" onclick="swtichTologin()">Login</button>
                    <button style="color: rgb(204, 106, 8)" type="button" class="toggle-btn" onclick="swtichToregister()">Register</button>
                </div>
                <form id="login" class="input-group-login">
                    <input style="color: rgb(231, 190, 139)" id="login-email" type="email" class="input-field" placeholder="Email Id"required>
                    <input style="color: rgb(231, 190, 139)" id="login-password" type="password" class="input-field" placeholder="Enter Password" required>
                    <input type="checkbox" class="check-box"> <span>Remember Password</span>
                    <button style="color: rgb(255, 255, 255)" type="submit" class="submit-btn" onclick="login()">Login</button>
                </form>
                <form id="register" class="input-group-register">
                    <input style="color: rgb(231, 190, 139)" id="register-first-name" type="text" class="input-field" placeholder="First Name" required>
                    <input style="color: rgb(231, 190, 139)" id="register-last-name" type="text" class="input-field" placeholder="Last Name" required>
                    <input style="color: rgb(231, 190, 139)" id="register-email" type="email" class="input-field" placeholder="Email Id" required>
                    <input style="color: rgb(231, 190, 139)" id="register-phone" type="number" class="input-field" placeholder="Phone No" required>
                    <input style="color: rgb(231, 190, 139)" id="register-password" type="password" class="input-field" placeholder="Enter Password" required>
                    <input type="checkbox" class="check-box"> <span>I agree to the terms & conditions</span>
                    <button style="color: rgb(255, 255, 255)" type="submit" class="submit-btn" onclick="registerUser()">Register</button>
                </form>
            </div> 

        </div>

        <script>
            var x = document.getElementById("login");
            var y = document.getElementById("register");
            var z = document.getElementById("btn");

            function swtichToregister(){
                x.style.left = "-400px";
                y.style.left = "50px";
                z.style.left = "110px";
            }
            function swtichTologin(){
                x.style.left = "50px";
                y.style.left = "450px";
                z.style.left = "0";
            }
        </script>
        <script>
            var modal = document.getElementById("hero");
            window.onclick = function(event)
            {
                if (event.target == modal)
                {
                    modal.style.display = "none";
                 
                }   
            }
        </script>
        <script> 
         function login()
         {
             console.log("Login" + $("#login-email").val() + ":" + $("#login-password").val())
             $.ajax({
                 type: "GET",
                 url: "/events.html",
                 dataType: "html",
                 async: false,
                 headers: {
                     "Authorization": "Basic " + btoa($("#login-email").val() + ":" + $("#login-password").val())
                 },
                 success: function (response) {
                     self.addEventListener("fetch", (event) => {
                         var currentUrl = new URL(event.request.url);
                         if (currentUrl.origin === location.origin){
                             var newRequest = new Request(event.request, {
                                 mode: "cors",
                                 credentials: "same-origin",
                                 headers: {
                                     "Authorization": "Basic " + btoa($("#login-email").val() + ":" + $("#login-password").val()) + "="
                                 }
                             });
                             event.respondWith(fetch(newRequest));
                         }
                         else {
                             event.respondWith(fetch(event.request));
                         }
                     });
                     console.log(response.type)
                     localStorage.setItem("authToken", "Basic " + btoa($("#login-email").val() + ":" + $("#login-password").val() + "="));
                     processAjaxData(response, "events.html")
                 }
             });
         }
         function registerUser() {
             var mutation = `
             mutation AddUser {
                addUser(
                    userLoginInfo: {
                        firstName:"` + $("#register-first-name").val() + `",
                        lastName:"` + $("#register-last-name").val() + `",
                        email:"` + $("#register-email").val() + `",
                        phoneNo:` + $("#register-phone").val() + `,
                        password:"` + $("#register-password").val() + `"
                     })
             }`;

             console.log(mutation)
             fetch("/graphql", {
                 method: "POST",
                 headers: {
                     "Content-Type": "application/json",
                     "Accept": "application/json",
                 },
                 body: JSON.stringify({query: mutation})
             }).then(result =>{
                 loginRequest(btoa($("#register-first-name") + ":" + $("#register-password") + "="))
             })

         }
        </script>
    </body>
<html/>